require 'nokogiri'
require 'open-uri'
require 'axlsx'
require 'mechanize'

url = "https://www.nwacsports.org/Letters_of_Intent"

begin
  # Load the HTML content of the page using Nokogiri and open-uri
  m = Mechanize.new
  m.user_agent_alias = "Windows Mozilla"
  page = m.get(url)
  doc = Nokogiri::HTML(page)
rescue Errno::ENOENT => e
  puts "Error: could not open URL '#{url}' (#{e.message})"
  exit
end

rows = doc.xpath('//table[@class="loitable"]/tr[contains(td[2], "Women\'s Basketball")]')

workbook = Axlsx::Package.new
worksheet = workbook.workbook.add_worksheet(name: "Women's Basketball")

rows.each do |row|
  data = row.xpath('td').map(&:text)
  
  worksheet.add_row(data)
end

workbook.serialize("women_basketball.xlsx")